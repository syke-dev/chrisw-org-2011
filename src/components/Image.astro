---

// Example: <Image src='wattbodies/robots/zoomoid.png' width={100} height={100} fit={Fit.Squeeze} />

export enum Fit {
	Contain = "contain",
	Cover = "cover",
	Crop = "crop",
	Pad = "pad",
	ScaleDown = "scale-down",
	Squeeze = "squeeze",
}

interface Props {
	src: string;
	width?: Number;
	height?: Number;
	fit?: Fit;
	border?: string;
	link?: Boolean;
	class?: Number;
}

const { src, width, height, fit, border, link = false, class: className } = Astro.props;

const transforms = function() {

	// https://developers.cloudflare.com/images/transform-images/transform-via-url/

	let array: string[] = [];

	array.push('format=auto');

	if (Number.isFinite(width)) {
		array.push(`width=${width}`);
	}

	if (Number.isFinite(height)) {
		array.push(`height=${height}`);
	}

	if (fit !== undefined) {
		array.push(`fit=${fit}`);
	}

	return array.join(',');

};

const imageSource = src.startsWith('/') ? src.slice(1) : src;

---

<a href={link ? `https://media.chrisw.gg/${imageSource}` : undefined}>
	<img
		src=`https://media.chrisw.gg/cdn-cgi/image/${transforms()}/${imageSource}`
		width={width}
		height={height}
		border={border}
		class={className}
	/>
</a>